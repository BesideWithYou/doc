# 【Node.js实战系列】Express 从零搭建博客系统(一)

## 前言

> 这个系列的文章会从零开始教你怎么使用 Express.js 去搭建一个能用的博客系统，是真的从零，手把手的那种！！！让你打通 JS 前后端任督二脉，看不懂的直接来找我！
>
> 本系列文章也会收录在公众号《泡芙学前端》中，持续更新中... 欢迎关注

首先要知道我们现在要做个怎样的系统，比如博客能干嘛？

那它的核心功能肯定是对于文章的增删改查嘛，所以我们就有了以下的几个核心接口：

- 发表博客
- 分页查看博客列表
- 根据id查看博客详情
- 根据id删除博客(软删除)
- 根据id修改博客内容
- 上传文件（比如博客内的图片）

好了，这几个接口搞完了其实博客系统的雏形就已经有了。

但是我们觉得哎，好像还不太够，还缺点啥？所以接下来我们继续给博客添加功能，比如用户登录注册功能：

- 用户注册
- 用户登录
- 用户退出

嗯，开始有点内味了，到这里一个基本的博客系统就其实已经可以自己用起来了。

接下来我们就继续锦上添花，比如我们为了让博客能分类，来添加一个标签系统，可以给博客打上分类的标签，比如 JavaScript、Node.js、React 等标签

- 新增标签
- 修改标签
- 查询标签
- 删除标签(软删除)

到这里为止一个博客的雏形就已经有了，后续可以基于这个雏形来添加更多的功能，比如接入 OSS 对象存储，把文件上传到云存储，博客文章接入 Redis 缓存进行优化等，不过那都是后话了，我们这里就先把一个雏形从零开始搭建完成。

首先我们先来完成基本环境的一个搭建工作哈

## 1.搭建初始环境

- 找到一个地方创建目录，比如 express-blog

- 进入目录，控制台运行 `npm init -y`

- 修改 package.json 中的 scripts 字段为下面代码，作为启动入口

  - ```json
    "scripts": {
      "start": "node index.js"
    },
    ```

- 安装依赖：`npm install express sequelize mysql2 body-parser cors`
  - express: 我们要用的服务端框架
  - sequelize: 操作数据库的 orm
  - mysql2: 数据库驱动
  - body-parser: 用来解析 request body 的内容
  - cors: 解决跨域

上面搞完后，我们就得到了这样的一个 package.json 文件

```json
{
  "name": "expree-blog",
  "version": "1.0.0",
  "description": "博客服务端",
  "main": "app.js",
  "scripts": {
    "start": "node app.js"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "body-parser": "^1.20.2",
    "cors": "^2.8.5",
    "express": "^4.18.2",
    "mysql2": "^3.3.3",
    "sequelize": "^6.31.1"
  }
}
```

到这里我们就完成了第一步工作，接下来我们就要创建目录结构了

```
- models/          // 存放 Sequelize 模型文件
- controllers/     // 存放控制器文件
- routes/          // 存放路由文件
- middleware/      // 存放中间件文件
- config/          // 存放配置文件
  - database.js    // 存放数据库配置
- app.js           // Express.js 应用主文件
- package.json     // 项目依赖
```

## 2.数据库配置

内容我们后续再来填入

```js
// config/database.js

// TODO
module.exports = {
  development: {
    username: 'your_username',
    password: 'your_password',
    database: 'your_database',
    // 设置为本地
    host: 'localhost',
    // 指定数据库
    dialect: 'mysql'
  },
  production: {
    // 配置生产环境的数据库信息
  }
};
```

## 3.构建数据库模型

现在我们要在 `models/` 目录下创建下面这几个模型文件：

- `User.js`：用户模型
- `Blog.js`：博客模型
- `Tag.js`：标签模型

然后在各个模型中去定义相应的字段：

### 用户模型

```js
// models/User.js

const { DataTypes } = require('sequelize');
const sequelize = require('../config/database');

const User = sequelize.define('User', {
  id: {
    type: DataTypes.INTEGER,
    primaryKey: true,
    autoIncrement: true
  },
  username: {
    type: DataTypes.STRING,
    allowNull: false,
    unique: true
  },
  password: {
    type: DataTypes.STRING,
    allowNull: false
  },
  nickname: {
    type: DataTypes.STRING,
    allowNull: false
  },
  lastOnlineTime: {
    type: DataTypes.DATE
  },
  createdAt: {
    type: DataTypes.DATE,
    allowNull: false
  }
});

module.exports = User;
```

### 博客模型

```js
// models/Blog.js

const { DataTypes } = require("sequelize");
const sequelize = require("../config/database");
const User = require("./User");

const Blog = sequelize.define("Blog", {
  id: {
    type: DataTypes.INTEGER,
    primaryKey: true,
    autoIncrement: true,
  },
  title: {
    type: DataTypes.STRING,
    allowNull: false,
  },
  content: {
    type: DataTypes.TEXT,
    allowNull: false,
  },
  tags: {
    type: DataTypes.STRING,
  },
  createdAt: {
    type: DataTypes.DATE,
    allowNull: false,
  },
  updatedAt: {
    type: DataTypes.DATE,
    allowNull: false,
  },
});

// Blog 模型与 User 模型之间的关联
Blog.belongsTo(User, { foreignKey: "userId" });

module.exports = Blog;
```

### 标签模型

```js
// models/Tag.js

const { DataTypes } = require("sequelize");
const sequelize = require("../config/database");

const Tag = sequelize.define("Tag", {
  id: {
    type: DataTypes.INTEGER,
    primaryKey: true,
    autoIncrement: true,
  },
  name: {
    type: DataTypes.STRING,
    allowNull: false,
    unique: true,
  },
});

module.exports = Tag;
```

