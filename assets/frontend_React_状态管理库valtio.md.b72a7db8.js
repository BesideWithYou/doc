import{_ as s,c as a,o as n,d as l}from"./app.4ff0cbba.js";const C=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[{"level":2,"title":"Valtio 是什么","slug":"valtio-是什么","link":"#valtio-是什么","children":[]},{"level":2,"title":"作者是谁？","slug":"作者是谁","link":"#作者是谁","children":[]},{"level":2,"title":"在 React 中的基本用法","slug":"在-react-中的基本用法","link":"#在-react-中的基本用法","children":[]},{"level":2,"title":"订阅数据","slug":"订阅数据","link":"#订阅数据","children":[]}],"relativePath":"frontend/React/状态管理库valtio.md","lastUpdated":1676560723000}'),e={name:"frontend/React/状态管理库valtio.md"},p=l(`<h2 id="valtio-是什么" tabindex="-1">Valtio 是什么 <a class="header-anchor" href="#valtio-是什么" aria-hidden="true">#</a></h2><blockquote><p>Valtio makes proxy-state simple for React and Vanilla</p></blockquote><p>就是让数据状态代理在 React 和原生 JS (Vanilla) 中变得更加简单的一个状态管理库，有点类似于 Mobx 的理念，使用状态代理去驱动 React 视图来更新。Valtio 是一个很轻量级的状态管理库</p><h2 id="作者是谁" tabindex="-1">作者是谁？ <a class="header-anchor" href="#作者是谁" aria-hidden="true">#</a></h2><p>作者叫做 <a href="https://github.com/dai-shi" target="_blank" rel="noreferrer">Daishi Kato</a>（带师？是你吗？）他是日本东京人，这货很强啊，是个全职开源作者，在专门搞各种状态管理库，其中 <a href="https://github.com/pmndrs/jotai" target="_blank" rel="noreferrer">Jotai 12.1k⭐</a>、 <a href="https://github.com/pmndrs/zustand" target="_blank" rel="noreferrer">Zustand 27.4k⭐</a>、<a href="https://github.com/pmndrs/valtio" target="_blank" rel="noreferrer">Valtio 6.3k⭐</a> ，这三个状态管理库都是这货搞的，而且用的人都很多。其中 Jotai 是受到 Recoil 的启发搞得， Zustand 是受到 Redux 启发搞的，Valtio 是受 Mobx 启发搞的，但是它搞的这几个要做得比前人的要更好，所谓青出于蓝而胜于蓝哈。不过我们今天这里的主角是 Valtio。</p><h2 id="在-react-中的基本用法" tabindex="-1">在 React 中的基本用法 <a class="header-anchor" href="#在-react-中的基本用法" aria-hidden="true">#</a></h2><p>下面主要是使用了 proxy 和 useSnapshot 这两个 API，proxy 会为原始对象创建一个 Proxy 代理。使用 useSnapshot 会创建一个组件中的本地快照 snap，并且这个 snap 快照是只读的(readonly)，当改变 state.count 时，该组件会被重新渲染，但是改变 state.text 的值时，组件不会重渲染，并且这里的渲染过程是被经过优化的。</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">proxy</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">useSnapshot</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">valtio</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> state </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">proxy</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">count</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">text</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello world</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Counter</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">snap</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">useSnapshot</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">state</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">snap</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">count</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">onClick</span><span style="color:#89DDFF;">={()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">++</span><span style="color:#A6ACCD;">state</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">count</span><span style="color:#89DDFF;">}&gt;</span><span style="color:#A6ACCD;">+1</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="订阅数据" tabindex="-1">订阅数据 <a class="header-anchor" href="#订阅数据" aria-hidden="true">#</a></h2><div class="language-tsx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"></div></div>`,10),o=[p];function t(r,c,i,y,D,F){return n(),a("div",null,o)}const A=s(e,[["render",t]]);export{C as __pageData,A as default};
